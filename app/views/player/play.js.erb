function sm2_perform_action (action_name) {
  switch(action_name) {
      case 'pause':
          soundManager.pause('mix');
          break;
      case 'resume':
          soundManager.resume('mix');
          break;
      default:
          alert("Unspecifed SM2 action.");
  }
}
function hide_big_and_sm_play_btn () {
  $("#play-btn").hide(0);
  $("#play-btn-lg").hide(0);
}
function reveal_player_container () {
  $("#music_player").attr('play-state', 'playing');
  $("#music_player_container").slideDown(300,'swing',function() {
    // Action after player control show up.
  });
}
function create_sm2_with_audio_url (audio_url) {
  return soundManager.createSound({
    url: audio_url,
    id: 'mix',
    volume: 100,
    autoPlay: true,
    onplay: function () {
      hide_big_and_sm_play_btn();
    },
    onfinish: function(){
      // TODO: call next track
      // curl http://8tracks.com/sets/111696185/next.json?mix_id=14
      $("#music_player_container").slideUp(300, 'swing'); // swing or linear
      $("#play-btn-lg").fadeIn(300);
    },
    whileplaying: function  () {
      // soundManager._writeDebug('sound '+this.id+' playing, '+this.position+' of '+this.duration);
    },
    ontimeout: function(status){
      alert('SM2 failed to start. Flash missing, blocked or security error?');
      alert('The status is ' + status.success + ', the error type is ' + status.error.type);
    }
  });
}
function delete_previous_sm2_and_create_new_one_fron_audio_stream_url (url) {
  if (soundManager.getSoundById('mix')){ 
    soundManager.destroySound('mix');
    create_sm2_with_audio_url(url);
  } else {
    create_sm2_with_audio_url(url);
  }
}
function bind_control_action () {
  $("#pause-btn").on('click', function () {
    sm2_perform_action('pause');
    $(this).hide(0);
    $("#play-btn").show(0);
  })
  $("#play-btn").on('click', function(){
    sm2_perform_action('resume');
    $(this).hide(0);
    $("#pause-btn").show(0);
  });
}
function hide_play_btn_lg_if_current () { 
  if ( soundManager.getSoundById('mix').url == "<%= @audio_stream_url %>" ) {
    $("#play-btn-lg").hide(0);
  }
}
hide_play_btn_lg_if_current();
reveal_player_container();
bind_control_action();
delete_previous_sm2_and_create_new_one_fron_audio_stream_url("<%= @audio_stream_url %>");
